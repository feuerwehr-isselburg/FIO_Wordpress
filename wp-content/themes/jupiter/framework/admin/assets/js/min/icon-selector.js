!function($){function init_icon_selector(){localforage.getItem("mk_jupiter_icons").then(function(value){value?display_list_of_icons(!0):cache_all_icons()})["catch"](function(err){console.log(err)})}function display_list_of_icons(clear){var clear=clear||!1;clear&&($lib.empty(),global_index=pag_start,is_inf_scroll_active=!0,$search_input.val(""),$lib.append('<li class="mk-ip-lib-item mk-ip-lib-item-first"><div class="mk-ip-lib-item-inner"><div class="mk-ip-lib-item-icon">'+$current_svg[0].outerHTML+"</div></div></li>"),handle_selected_icon($lib.find(".mk-ip-lib-item-first")[0]));var initated_start_index=global_index;localforage.getItem("mk_jupiter_icons").then(function(data){var icons="",loop_index=0;$.each(data,function(name,source){return!(loop_index>initated_start_index+pag_count)&&void(loop_index<initated_start_index?loop_index++:(icons+='<li class="mk-ip-lib-item"><div class="mk-ip-lib-item-inner"><div class="mk-ip-lib-item-icon">'+source+"</div></div></li>",global_index++,loop_index++))}),is_inf_scroll_active&&$lib.append(icons)})}function display_search_of_icons(icon_name){is_inf_scroll_active=!1,$lib.empty(),localforage.getItem("mk_jupiter_icons").then(function(data){var icons="",regex=new RegExp("-"+icon_name+"-","i");$.each(data,function(name,source){regex.test(name)&&(icons+='<li class="mk-ip-lib-item"><div class="mk-ip-lib-item-inner"><div class="mk-ip-lib-item-icon">'+source+"</div></div></li>")}),$lib.append(icons)})}function cache_all_icons(){jQuery.ajax({method:"POST",url:ajax_url,data:{pagination_start:0,pagination_count:-1,icon_family:"all",action:"mk_get_icons_list"}}).success(function(obj){localforage.setItem("mk_jupiter_icons",obj.data).then(function(value){console.log("Icons were cached."),display_list_of_icons()})["catch"](function(err){console.log("Icons were NOT cached: "+err)})})}function handle_selected_icon(elem){var $this=$(elem);$last_selected_icon instanceof jQuery&&$last_selected_icon.removeClass("mk-selected"),$last_selected_icon=$this,$this.addClass("mk-selected")}var locolized_data=icon_selector_locolized_data,ajax_url=locolized_data.ajax_url,$icon_selector=$(".mk-ip"),$search_input=$(".mk-ip-search-input"),$close_btn=$(".mk-ip-header-close-btn"),$cancel_btn=$(".mk-ip-cancel-btn"),$save_btn=$(".mk-ip-save-btn"),$small_view=$(".mk-ip-lib-view-small"),$large_view=$(".mk-ip-lib-view-large"),$lib_container=$(".mk-ip-lib-wrap"),pag_start=0,pag_count=200,global_index=pag_start,is_inf_scroll_active=!0,$last_selected_icon="",$vc_value_input="",$vc_value_view="",$current_svg="",$lib=$(".mk-ip-lib");$("body").on("click",".mk-vc-icon-selector-btn",function(e){e.preventDefault(),$vc_value_input=$(this).siblings(".icon_selector_field"),$vc_value_view=$(this).siblings(".mk-vc-icon-selector-view-wrap").find(".mk-vc-icon-selector-view"),$current_svg=$vc_value_view.children("svg").clone(),$icon_selector.fadeIn(300),$search_input.focus(),init_icon_selector()}),$save_btn.on("click",function(){var icon_class_name=$last_selected_icon.find("svg").attr("data-name"),$icon_srouce=$last_selected_icon.find("svg").clone();$vc_value_input.val(icon_class_name),$vc_value_view.empty().append($icon_srouce),$icon_selector.fadeOut(300)}),$close_btn.add($cancel_btn).on("click",function(){$icon_selector.fadeOut(300)}),$search_input.on("keyup",_.debounce(function(e){""===$.trim($search_input.val())?(is_inf_scroll_active=!0,display_list_of_icons(!0)):display_search_of_icons($search_input.val())},500)),$small_view.on("click",function(){$(this).addClass("mk-selected").siblings().removeClass("mk-selected"),$lib.removeClass("mk-ip-lib-large").addClass("mk-ip-lib-small")}),$large_view.on("click",function(){$(this).addClass("mk-selected").siblings().removeClass("mk-selected"),$lib.removeClass("mk-ip-lib-small").addClass("mk-ip-lib-large")}),$lib_container.scroll(function(){$lib_container.scrollTop()+$lib_container.height()>$lib.prop("scrollHeight")-100&&is_inf_scroll_active&&display_list_of_icons(!1)}),$lib.on("click",".mk-ip-lib-item",function(){handle_selected_icon(this)})}(jQuery);